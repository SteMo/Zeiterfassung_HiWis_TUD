<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <style type='text/css'>
			img.modifyImage{
				width: 15px;
			}
		</style>
        <title id='title'>HiwiVerwaltung | Vertr&auml;ge</title>
 
        <!-- ** CSS ** -->
        <!-- base library -->
        <link rel="stylesheet" type="text/css" href="extjs/resources/css/ext-all.css" />
 
        <!-- overrides to base library -->
 
 
        <!-- ** Javascript ** -->
        <!-- ExtJS library: all widgets -->
        <script type="text/javascript" src="extjs/bootstrap.js"></script>
 
 
        <!-- overrides to library -->
 
        <!-- extensions -->
 
        <!-- page specific -->
 
        <script type="text/javascript">      
        // Path to the blank image should point to a valid location on your server
        // Diese URL führt ins Nichts, wo kommt denn das Bild her?
		// Wird in app.js sowie in den Dateien in /admin noch mindestens 5x angegeben, das sollte nicht sein.
	    Ext.BLANK_IMAGE_URL = 'extjs/resources/images/default/s.gif';
 
        Ext.onReady(function(){
        
          var fbStore = Ext.create('Ext.data.Store', {
              fields: ['name'],
              data : [
                  {"name":"Alle"},
                  {"name":"CMS"},
                  {"name":"NCS"},
                  {"name":"HCE"},
                  {"name":"DKE"}
              ]
          });
          
          var ptStore = Ext.create('Ext.data.Store', {
              fields: ['name'],
              data : [
				  {"name":"Alle"},
                  {"name":"Prof"},
                  {"name":"Mitarbeiter"},
                  {"name":"HiWi"}
              ]
          });
          
          Ext.create('Ext.data.Store', {
              storeId:'peopleStore',
              fields:['id', 'name', 'fachgebiet', 'position', 'prof_zuordnung', 'mitarbeiter_zuordnung'],
              data:{'items':[
                  {"id": 1, "name":"Lisa", "fachgebiet":"DKE", "position":"Prof", "prof_zuordnung": -1, "mitarbeiter_zuordnung": -1},
                  {"id": 2, "name":"Bart", "fachgebiet":"NCS", "position":"Prof", "prof_zuordnung": -1, "mitarbeiter_zuordnung": -1},
                  {"id": 3, "name":"Homer", "fachgebiet":"HCE", "position":"Prof", "prof_zuordnung": -1, "mitarbeiter_zuordnung": -1},  
                  {"id": 4, "name":"Dieter", "fachgebiet":"CMS", "position":"Prof", "prof_zuordnung": -1, "mitarbeiter_zuordnung": -1}, 
                  {"id": 5, "name":"Lina", "fachgebiet":"CMS", "position":"Mitarbeiter", "prof_zuordnung": 4, "mitarbeiter_zuordnung": -1}, 
				  {"id": 6, "name":"Tobias", "fachgebiet":"NCS", "position":"Mitarbeiter", "prof_zuordnung": 2, "mitarbeiter_zuordnung": -1},
                  {"id": 7, "name":"Emil", "fachgebiet":"HCE", "position":"Hiwi", "prof_zuordnung": 3, "mitarbeiter_zuordnung": -1}, 
                  {"id": 8, "name":"Siegfried", "fachgebiet":"DKE", "position":"HiWi", "prof_zuordnung": 1, "mitarbeiter_zuordnung": -1}, 
                  {"id": 9, "name":"Mira", "fachgebiet":"NCS", "position":"Hiwi", "prof_zuordnung": -1, "mitarbeiter_zuordnung": 6},                       
                  {"id": 10, "name":"Marge", "fachgebiet":"NCS", "position":"HiWi", "prof_zuordnung": 2, "mitarbeiter_zuordnung": -1},            
                  {"id": 11, "name":"Mr. Burns", "fachgebiet":"CMS", "position":"HiWi", "prof_zuordnung": -1, "mitarbeiter_zuordnung": 5}            					
             ]},
              proxy: {
                  type: 'memory',
                  reader: {
                      type: 'json',
                      root: 'items'
                  }
              }
          });
      
          Ext.create('Ext.data.Store', {
              storeId:'dataStore',
              fields:['arbeitgeber', 'arbeitnehmer', 'vertragsart', 'sollstunden', 'bezahlung', 'vertrags_datei'],
              data:{'items':[
                  {"id": 1, "arbeitgeber":1, "arbeitnehmer":-1, "sollstunden":-1, "bezahlung":-1, "vertrags_datei":"datei.pdf oder pdf-Daten"},
                  {"id": 2, "arbeitgeber":4, "arbeitnehmer":5, "sollstunden":20, "bezahlung":400, "vertrags_datei":"datei.pdf oder pdf-Daten"},
                  {"id": 3, "arbeitgeber":2, "arbeitnehmer":6, "sollstunden":15, "bezahlung":200, "vertrags_datei":"datei.pdf oder pdf-Daten"},
                  {"id": 4, "arbeitgeber":1, "arbeitnehmer":8, "sollstunden":12, "bezahlung":252.50, "vertrags_datei":"datei.pdf oder pdf-Daten"},
                  {"id": 5, "arbeitgeber":6, "arbeitnehmer":9, "sollstunden":16, "bezahlung":300, "vertrags_datei":"datei.pdf oder pdf-Daten"},
                  {"id": 6, "arbeitgeber":2, "arbeitnehmer":10, "sollstunden":10, "bezahlung":200, "vertrags_datei":"datei.pdf oder pdf-Daten"},
                  {"id": 7, "arbeitgeber":5, "arbeitnehmer":11, "sollstunden":-1, "bezahlung":500, "vertrags_datei":"datei.pdf oder pdf-Daten"},
                  {"id": 8, "arbeitgeber":3, "arbeitnehmer":7, "sollstunden":-1, "bezahlung":"15€/h", "vertrags_datei":"datei.pdf oder pdf-Daten"},

                  ]},
              proxy: {
                  type: 'memory',
                  reader: {
                      type: 'json',
                      root: 'items'
                  }
              }
          });
          
          var getPerson = function(value) {
							if(value==-1) {
								return "Keine Daten vorhanden";
							}
							var dataStore;
							var idx;
							if(Ext.data.StoreManager.lookup('peopleStore').isFiltered()) {
								dataStore = Ext.data.StoreManager.lookup('peopleStore').snapshot;
								idx = dataStore.findIndexBy(function(o,k) {
										if(k==value) {
											return true;
										}
										return false;
									});
							} else {
								dataStore = dataStore = Ext.data.StoreManager.lookup('peopleStore');
								idx = dataStore.findExact("id",value);
							}
							if(idx === -1) {
								return "(404 - id: "+ value + ")";
							}
							return dataStore.getAt(idx).get("name")+" ("+dataStore.getAt(idx).get("position")+"/"+dataStore.getAt(idx).get("fachgebiet")+")";
						}
                    
        
          Ext.create('Ext.Viewport', {
              layout: {
                  type:'vbox',
                  padding:'5',
                  align:'center',
                  autoWidth: true,
              },              
              items: [{                        
                      xtype: 'panel',
                      title: '',
                      width: 700,
                      
                      flex: 0,  
                      tbar: [
						{ xtype: 'button', text: 'Dashboard' },
                        { xtype: 'button', text: 'Fachgebiete' },
                        { xtype: 'button', text: 'Personen', handler: function() {
							window.location.href = "index.html";
							} },
                        { xtype: 'button', text: 'Verträge', handler: function() {
							window.location.href = "vertraege.html";
							}},
                        { xtype: 'button', text: 'Aufgaben' },
                        { xtype: 'button', text: 'Berichte' }
                      ]                    
              },{
                xtype: 'fieldset',
                id: 'listOfFilters',
                width: 700,
                title: '',
                items: [
                    {
                        xtype: 'button',
                        text: 'Vertrag hinzufügen',
                        icon: ''
                    } 
                ]
            },{
                xtype: 'grid',
                id: 'listOfContracts',
                width: 700,
                title: '',
                autoHeight: true,
                store: Ext.data.StoreManager.lookup('dataStore'),
                columns: [
                    {
                        xtype: 'gridcolumn',
                        dataIndex: 'arbeitgeber',
                        header: 'Arbeitgeber',
                        sortable: true,
                        width: 200,
                        renderer: getPerson
                    },
                    {
                        xtype: 'gridcolumn',
                        dataIndex: 'arbeitnehmer',
                        header: 'Arbeitnehmer',
                        sortable: true,
                        width: 200,
                        align: 'left',
                        renderer: getPerson
                    },
                    {
                        xtype: 'gridcolumn',
                        dataIndex: 'sollstunden',
                        header: 'Sollstunden',
                        sortable: true,
                        width: 100,
                        renderer: function(value) {
							if(value==-1) return "Offen";
							return value;
						} 
                    },
                    {
                        xtype: 'gridcolumn',
                        dataIndex: 'bezahlung',
                        header: 'Bezahlung',
                        sortable: true,
                        width: 150,
                        renderer: function(value) {
							if(value==-1) return "Keine";
							return value;
						} 

                    },{
						xtype:'actioncolumn', 
						width:50,
						items: [{
							icon: 'images/edit.png',  // Use a URL in the icon config
							iconCls: 'modifyImage',
							tooltip: 'Edit',
							handler: function(grid, rowIndex, colIndex) {
								var rec = grid.getStore().getAt(rowIndex);
								Ext.create('Ext.window.Window', {
									title: 'Hello',
									height: 200,
									width: 400,
									layout: 'fit',
									items: {  // Let's put an empty grid in just to illustrate fit layout
										xtype: 'grid',
										data: grid.getStore().getAt(rowIndex),
										border: false,
										columns: [{ header: 'Name',
													dataIndex: "arbeitnehmer"
												  },{
													header: 'Sollsunden',
													dataIndex: "sollstunden"
												  }],                 // One header just for show. There's no data,
										store: Ext.create('Ext.data.ArrayStore', {}) // A dummy empty data store
										}
								}).show();
							}
						},{
							icon: 'images/delete.png',
							iconCls: 'modifyImage',
							tooltip: 'Delete',
							handler: function(grid, rowIndex, colIndex) {
								var rec = grid.getStore().getAt(rowIndex);
								alert("Beende Vertrag mit " + getPerson(rec.get('arbeitnehmer')));
							}                
						}]
					}],
					selType: 'rowmodel'
				}]					
            });
 
        }); //end onReady
        </script>
 
    </head>
    <body>
    </body>
</html>
